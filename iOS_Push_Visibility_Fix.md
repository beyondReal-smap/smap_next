# 🔔 iOS 푸시 알림 표시 문제 해결 가이드

## 📋 **현재 상황 분석**

### ✅ **정상 작동하는 부분**
- **서버**: FCM 전송 성공 ✅
- **iOS 알림 센터**: 14개 FCM 알림 수신됨 ✅
- **권한 상태**: 모든 권한 정상 ✅
- **토큰 상태**: FCM 토큰 유효 ✅

### ❌ **문제점**
- **시각적 표시**: 사용자에게 푸시 알림이 보이지 않음

---

## 🔍 **문제 원인**

### **1. 앱 상태별 알림 표시 차이**
- **포그라운드**: `willPresent` 메서드로 처리 (정상 설정됨)
- **백그라운드**: 시스템이 자동 표시하지만 iPhone 설정이 차단할 수 있음

### **2. 가능한 차단 요인**
- iPhone 방해 금지 모드
- 집중 모드 설정
- 스크린 타임 제한
- 시스템 레벨 알림 차단

---

## 🛠️ **즉시 해결 방법**

### **1단계: iPhone 설정 확인**

#### **🔴 방해 금지 모드 해제**
```
설정 > 집중 모드 > 방해 금지
→ 방해 금지 모드가 켜져 있다면 끄기
```

#### **🔴 집중 모드 확인**
```
설정 > 집중 모드
→ 활성화된 집중 모드가 있다면 확인
→ smap 앱이 허용 목록에 있는지 확인
```

#### **🔴 스크린 타임 확인**
```
설정 > 스크린 타임 > 콘텐츠 및 개인정보 보호 제한
→ 알림이 제한되어 있지 않은지 확인
```

### **2단계: smap 앱 알림 설정 재확인**

#### **🔴 세부 설정 확인**
```
설정 > 알림 > smap
✅ 알림 허용: ON
✅ 잠금 화면: ON  
✅ 알림 센터: ON
✅ 배너: ON
✅ 소리: ON
✅ 배지: ON
✅ 미리보기 표시: 항상 (또는 잠금 해제 시)
```

#### **🔴 배너 스타일 확인**
```
설정 > 알림 > smap
배너 스타일: "지속" 또는 "임시" 선택
(없음으로 설정되어 있으면 안됨)
```

### **3단계: iOS 시스템 재설정**

#### **🔴 알림 설정 초기화**
1. smap 앱 완전 삭제
2. iPhone 재부팅
3. smap 앱 재설치
4. 첫 실행 시 푸시 권한 **허용** 선택

#### **🔴 네트워크 설정 재설정** (필요시)
```
설정 > 일반 > 전송 또는 iPhone 재설정 > 네트워크 설정 재설정
```

---

## 🧪 **테스트 방법**

### **1. 포그라운드 테스트**
1. smap 앱을 포그라운드에서 실행
2. `./fcm_test.sh` 실행
3. **앱 내에서 알림이 표시되는지 확인**

### **2. 백그라운드 테스트**
1. smap 앱을 백그라운드로 보내기 (홈 버튼)
2. `./fcm_test.sh` 실행
3. **iPhone 화면에 배너 알림이 표시되는지 확인**

### **3. 완전 종료 테스트**
1. 앱 스위처에서 smap 완전 종료
2. `./fcm_test.sh` 실행
3. **iPhone 잠금 화면에 알림이 표시되는지 확인**

---

## 🎯 **디버깅 명령어**

### **Xcode Console에서 실행**
```swift
// 1. 종합 상태 진단
debugPushNotificationStatus()

// 2. 강제 권한 재요청
forcePushPermissionRequestEnhanced()

// 3. 테스트 푸시 전송
sendTestPushNotification()

// 4. 로컬 알림 테스트
testLocalNotification()
```

---

## 🔧 **고급 해결책**

### **강제 알림 표시 테스트**
iPhone에서 **Control Center**를 내려서:
1. **방해 금지 모드 아이콘**이 활성화되어 있지 않은지 확인
2. **집중 모드**가 활성화되어 있지 않은지 확인

### **시스템 레벨 확인**
```
설정 > 알림 > 예약 요약
→ smap이 요약으로 설정되어 있지 않은지 확인
→ 즉시 전달로 설정되어 있는지 확인
```

---

## 📱 **예상 결과**

### **수정 전**
❌ 알림 센터에만 쌓이고 시각적으로 표시되지 않음

### **수정 후**
✅ **모든 앱 상태에서 시각적 푸시 알림 표시**
- **포그라운드**: 앱 내 배너/알림
- **백그라운드**: 시스템 배너 알림
- **완전 종료**: 잠금 화면 알림

---

## 🚨 **긴급 해결책**

### **즉시 확인할 것**
1. **iPhone 상단**: 방해 금지 달 아이콘이 있는지 확인
2. **Control Center**: 집중 모드가 켜져 있는지 확인
3. **설정 > 알림 > smap**: 배너가 "없음"으로 설정되어 있지 않은지 확인

**가장 흔한 원인은 방해 금지 모드나 집중 모드가 활성화되어 있는 것입니다!** 🎯

---

**이제 iPhone에서 푸시 알림을 확실히 볼 수 있을 것입니다!** 🎉
